<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Mirror Recorder — 10s</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif; text-align:center; padding:20px; }
    #preview { border:1px solid #ccc; width:480px; height:360px; /* mirrored visually */ transform: scaleX(-1); -webkit-transform: scaleX(-1); }
    canvas { display:none; } /* hidden: used for recording */
    button { margin-top:12px; padding:8px 14px; font-size:16px; }
    #count { font-weight:600; margin-left:10px; }
  </style>
</head>
<body>
  <h1>Mirror Recorder — 10s</h1>

  <!-- Mirrored preview (CSS only) -->
  <video id="preview" autoplay muted playsinline></video>
  <canvas id="mirrorCanvas"></canvas>
  <div>
    <button id="recordBtn">Start Recording (10 s)</button>
    <span id="count"></span>
  </div>

<script>
(async function () {
  const preview = document.getElementById('preview');
  const canvas = document.getElementById('mirrorCanvas');
  const ctx = canvas.getContext('2d');
  const btn = document.getElementById('recordBtn');
  const count = document.getElementById('count');

  let stream = null;
  let recorder = null;
  let drawLoop = null;
  let chunks = [];

  // Helper: draw the video onto canvas mirrored (so recorded frames are mirrored)
  function startDrawing() {
    // size canvas to match video
    canvas.width = preview.videoWidth;
    canvas.height = preview.videoHeight;

    // draw loop
    function draw() {
      // clear
      ctx.save();
      // Mirror horizontally: scaleX(-1) and draw shifted
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.translate(canvas.width, 0);
      ctx.scale(-1, 1);
      // draw video into canvas (mirrored)
      ctx.drawImage(preview, 0, 0, canvas.width, canvas.height);
      ctx.restore();
      drawLoop = requestAnimationFrame(draw);
    }
    drawLoop = requestAnimationFrame(draw);
  }

  function stopDrawing() {
    if (drawLoop) {
      cancelAnimationFrame(drawLoop);
      drawLoop = null;
    }
  }

  async function ensureStream() {
    if (stream) return stream;
    // Request camera + microphone (must be from secure origin / localhost)
    stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
    preview.srcObject = stream;

    // Wait for video me
